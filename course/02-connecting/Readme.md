# Connecting

## Recap the use-case that we're solving
### Use case/Problem statement
Alice - An employee at google, asked to get a new webserver. And the technical breakdown for this as below

- First spin up a new instance - Done
- Install a nginx webserver
- Start the webserver
- Test whether the webserver is accepting the requests are not.
- If webserver is working fine then customize the home page and make sure it displays the following information
<br>
`Welcome to WebServer`


In the previous section, we've successfully provioned our required hardware. Now we want to do the next step in the solution i.e., `install webserver`.

## Thought process
In order to install something in a machine first we've to get into the machine. Since our ec2 is virtual machine how do we get into it?

## Understanding different protocols
Protocol is set of standards and rules that are required to perform any action. We've different supported.

- HTTP (80)
    Used for web
- HTTPS (443)
    Used for web (Secure)
- SMTP (x)
    Used for email
- TCP (x)
    Used for network handshake/discovery
- SSH (21)
    Used for connecting into another machine (physical/virtual)
- FTP (22)
    Used for transfering file/folders to another machine

## Understanding SSH (Secure Shell or Secure Socket Shell)
SSH, also known as Secure Shell or Secure Socket Shell, is a network protocol that gives users, particularly system administrators, a secure way to access a computer over an unsecured network. SSH also refers to the suite of utilities that implement the SSH protocol. Secure Shell provides strong authentication and encrypted data communications between two computers connecting over an open network such as the internet. SSH is widely used by network administrators for managing systems and applications remotely, allowing them to log into another computer over a network, execute commands and move files from one computer to another.

Take away from above heavy definition
- It provide secure `authentication`
- It provide secure `encrypted data communication`


### How SSH works?
What actually SSH do when we want to try to connect to server? Well it does the following things. 

- Verification of server by client
- Generation of session key for encryption communication
- Authentication of client

- Verification of server by client

    The moment client initiates `ssh <user@ip>` the following things will happen.

    1. If the client is accessing the server for first time, client is asked to authenticate server manually by verifying public key of server. Public key of server can be found using ssh-keyscan command or can be found at different places(WHERE?GOOGLE!).Once the key is verified, the server is added in known_hosts file in ~/.ssh directory on client machine. The known_hosts file contains the information about all the verified servers by the client.
    
    2. If the client is not accessing the server for the first time, the serverâ€™s identity is matched with previously recorded information in known_hosts file for verification. 

- Generation of session key

    After the server is verified, both the parties negotiate a session key using a version of something called the Diffie-Hellman algorithm. This algorithm is designed in such a way that both the parties contribute equally in generation of session key. The generated session key is shared symmetric key i.e. the same key is used for encryption and decryption.

- Authentication of the client

    The final stage involves authentication of the client. Authentication is done using SSH key pair. As the name suggests, SSH key pair is nothing but a pair of two key to serve two different purposes. One is public key that is used to encrypt data and can be freely shared. The other one is private key that is used to decrypt data and is never shared with anyone.
    
    1. After symmetric encryption has been established, the authentication of the client happens as follows:
    
    2. The client begins by sending an ID for the key pair it would like to authenticate with to the server.
    
    3. The server checks the authorized_keys file of the account that the client is attempting to log into for the key ID.
    
    4. If a public key with matching ID is found in the file, the server generates a random number and uses the public key to encrypt the number and sends this encrypted message.
    
    5. If the client has the correct private key, it will decrypt the message to obtain the random number that was generated by the server.
    
    6. The client combines the obtained random number with the shared session key and calculates the MD5 hash of this value.
    
    7. The client then sends this MD5 hash back to the server as an answer to the encrypted number message.
    
    8. The server uses the same shared session key and the original number that it sent to the client to calculate the MD5 value on its own. It compares its own calculation to the one that the client sent back. If these two values match, it proves that the client was in possession of the private key and the client is authenticated.
    
    9. Asymmetry of the keys allows authentication of the client because client can only decrypt the messages if it has the correct associated private key.